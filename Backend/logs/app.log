2025-02-27 00:01:58,677 - __main__ - INFO - [app.py:218] - Received SIGINT signal
2025-02-27 00:01:58,681 - __main__ - INFO - [app.py:203] - Initiating graceful shutdown...
2025-02-27 00:02:03,684 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-27 00:02:03,685 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-27 00:02:03,685 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-27 00:02:03,688 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-27 00:02:03,689 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-27 00:02:03,690 - __main__ - INFO - [app.py:207] - Graceful shutdown completed
2025-02-27 00:02:03,692 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-27 00:02:03,693 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-27 00:02:03,693 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-27 00:02:03,694 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-27 00:02:03,694 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-27 00:02:03,694 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-27 00:02:03,694 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-27 00:02:03,695 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-27 00:02:03,696 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-27 00:02:03,696 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-27 00:02:45,073 - __main__ - INFO - [app.py:481] - Metrics server started on port 8000
2025-02-27 00:02:45,073 - services.model_manager - INFO - [model_manager.py:120] - Loading SeamlessM4T model: facebook/seamless-m4t-v2-large
2025-02-27 00:02:57,853 - services.model_manager - INFO - [model_manager.py:184] - Models loaded on CPU
2025-02-27 00:02:57,853 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-27 00:02:57,854 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-27 00:03:16,464 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-27 00:03:16,464 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-27 00:03:31,247 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-27 00:03:31,247 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-27 00:03:31,250 - services.model_manager - INFO - [model_manager.py:190] - Model initialization successful
2025-02-27 00:03:31,250 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-27 00:03:31,251 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-27 00:03:50,374 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-27 00:03:50,374 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-27 00:04:05,380 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-27 00:04:05,380 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-27 00:04:05,383 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-27 00:04:05,383 - __main__ - INFO - [app.py:505] - ==================================================
2025-02-27 00:04:05,383 - __main__ - INFO - [app.py:506] - Starting LinguaSync Backend
2025-02-27 00:04:05,383 - __main__ - INFO - [app.py:507] - Starting Flask app on port 5001 using cpu
2025-02-27 00:04:05,384 - __main__ - INFO - [app.py:508] - Python version: 3.12.4 | packaged by Anaconda, Inc. | (main, Jun 18 2024, 10:07:17) [Clang 14.0.6 ]
2025-02-27 00:04:05,384 - __main__ - INFO - [app.py:509] - Supported languages: ['fra', 'spa', 'deu', 'ita', 'por']
2025-02-27 00:04:05,384 - __main__ - INFO - [app.py:510] - Maximum audio length: 300 seconds
2025-02-27 00:04:05,384 - __main__ - INFO - [app.py:511] - Sample rate: 16000 Hz
2025-02-27 00:04:05,384 - __main__ - INFO - [app.py:515] - System memory: 36.0GB total, 16.1GB available
2025-02-27 00:04:05,384 - __main__ - INFO - [app.py:516] - CPU cores: 11
2025-02-27 00:04:05,384 - __main__ - INFO - [app.py:524] - Configuration:
2025-02-27 00:04:05,384 - __main__ - INFO - [app.py:525] - - Debug mode: False
2025-02-27 00:04:05,384 - __main__ - INFO - [app.py:526] - - CORS enabled: True
2025-02-27 00:04:05,384 - __main__ - INFO - [app.py:527] - - Rate limiting: 10 requests per minute
2025-02-27 00:04:05,384 - __main__ - INFO - [app.py:528] - - Metrics enabled: True (port 8000)
2025-02-27 00:04:05,384 - __main__ - INFO - [app.py:530] - ==================================================
2025-02-27 00:04:46,874 - services.diagnostics.spectral_analysis - INFO - [spectral_analysis.py:59] - Initialized SpectralAnalyzer with sample rate: 16000Hz
2025-02-27 00:04:46,874 - services.diagnostics.base - INFO - [base.py:75] - AudioDiagnostics initialized successfully
2025-02-27 00:04:46,874 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-27 00:04:46,875 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-27 00:05:04,359 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-27 00:05:04,359 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-27 00:05:24,899 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-27 00:05:24,899 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-27 00:05:24,902 - services.utils - INFO - [utils.py:57] - Performance - Function: process_video, Duration: 38.03s, Memory Change: 10.98MB
2025-02-27 00:05:24,902 - __main__ - INFO - [app.py:279] - Request to /process-video took 38.03s
2025-02-27 00:05:25,006 - services.video_routes - INFO - [video_routes.py:336] - Detected speech starts at: 0.54 seconds
2025-02-27 00:05:25,006 - services.audio_processor - INFO - [audio_processor.py:280] - Loading audio from: temp/temp_audio.wav
2025-02-27 00:05:25,006 - services.audio_processor - INFO - [audio_processor.py:282] - Audio info - Sample rate: 16000, Channels: 1
2025-02-27 00:05:25,007 - services.audio_processor - INFO - [audio_processor.py:291] - Original audio shape: torch.Size([1, 223260]), Frequency: 16000Hz
2025-02-27 00:05:25,047 - services.video_routes - INFO - [video_routes.py:117] - Generating text translation in fra
2025-02-27 00:05:33,541 - services.video_routes - INFO - [video_routes.py:126] - Generated text: Ok, c'est un test, voyons si nous pouvons traduire cette vidéo et aussi faire une synchronisation des lèvres.
2025-02-27 00:05:33,541 - services.video_routes - INFO - [video_routes.py:129] - Generating translated speech
2025-02-27 00:05:39,200 - services.video_routes - INFO - [video_routes.py:157] - Translation successful, audio shape: torch.Size([1, 81280])
2025-02-27 00:05:42,225 - services.video_routes - INFO - [video_routes.py:249] - Face detected with bounding box: (641, 245, 1057, 834)
2025-02-27 00:05:42,229 - services.video_routes - INFO - [video_routes.py:273] - Running Diff2Lip with command: python diff2lip/generate.py --model_path diff2lip/checkpoints/archive/data.pkl --video_path /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpfje9mbqs.mp4 --audio_path temp/translated_audio.wav --out_path temp/synced_video.mp4 --sampling_ref_type gt
2025-02-27 00:05:45,059 - services.video_routes - ERROR - [video_routes.py:286] - Diff2Lip failed with return code 1: /Users/robmills/audio-translation/Backend/diff2lip/guided_diffusion/dist_util.py:105: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  return th.load(io.BytesIO(data),
[rank0]: Traceback (most recent call last):
[rank0]:   File "/Users/robmills/audio-translation/Backend/diff2lip/guided_diffusion/dist_util.py", line 81, in load_state_dict
[rank0]:     return th.load(io.BytesIO(data), 
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1114, in load
[rank0]:     return _legacy_load(
[rank0]:            ^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1338, in _legacy_load
[rank0]:     magic_number = pickle_module.load(f, **pickle_load_args)
[rank0]:                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]: TypeError: 'persistent_load' is an invalid keyword argument for load()

[rank0]: During handling of the above exception, another exception occurred:

[rank0]: Traceback (most recent call last):
[rank0]:   File "/Users/robmills/audio-translation/Backend/diff2lip/guided_diffusion/dist_util.py", line 94, in load_state_dict
[rank0]:     return th.load(io.BytesIO(data), 
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1111, in load
[rank0]:     return _legacy_load(opened_file, map_location, _weights_only_unpickler, **pickle_load_args)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1338, in _legacy_load
[rank0]:     magic_number = pickle_module.load(f, **pickle_load_args)
[rank0]:                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/_weights_only_unpickler.py", line 383, in load
[rank0]:     return Unpickler(file, encoding=encoding).load()
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/_weights_only_unpickler.py", line 342, in load
[rank0]:     self.append(self.persistent_load(pid))
[rank0]:                 ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/_weights_only_unpickler.py", line 379, in persistent_load
[rank0]:     raise UnpicklingError("unsupported persistent id encountered")
[rank0]: _pickle.UnpicklingError: unsupported persistent id encountered

[rank0]: During handling of the above exception, another exception occurred:

[rank0]: Traceback (most recent call last):
[rank0]:   File "/Users/robmills/audio-translation/Backend/diff2lip/generate.py", line 403, in <module>
[rank0]:     main()
[rank0]:   File "/Users/robmills/audio-translation/Backend/diff2lip/generate.py", line 329, in main
[rank0]:     dist_util.load_state_dict(args.model_path, map_location='cpu')
[rank0]:   File "/Users/robmills/audio-translation/Backend/diff2lip/guided_diffusion/dist_util.py", line 105, in load_state_dict
[rank0]:     return th.load(io.BytesIO(data), 
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1114, in load
[rank0]:     return _legacy_load(
[rank0]:            ^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1338, in _legacy_load
[rank0]:     magic_number = pickle_module.load(f, **pickle_load_args)
[rank0]:                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]: _pickle.UnpicklingError: A load persistent id instruction was encountered, but no persistent_load function was specified.

2025-02-27 00:05:45,060 - services.video_routes - ERROR - [video_routes.py:290] - Model loading failed. Trying alternative approach...
2025-02-27 00:05:45,060 - services.video_routes - INFO - [video_routes.py:297] - Running Diff2Lip with forced CPU environment
2025-02-27 00:05:47,298 - services.video_routes - ERROR - [video_routes.py:305] - Alternative approach also failed: /Users/robmills/audio-translation/Backend/diff2lip/guided_diffusion/dist_util.py:105: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  return th.load(io.BytesIO(data),
[rank0]: Traceback (most recent call last):
[rank0]:   File "/Users/robmills/audio-translation/Backend/diff2lip/guided_diffusion/dist_util.py", line 81, in load_state_dict
[rank0]:     return th.load(io.BytesIO(data), 
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1114, in load
[rank0]:     return _legacy_load(
[rank0]:            ^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1338, in _legacy_load
[rank0]:     magic_number = pickle_module.load(f, **pickle_load_args)
[rank0]:                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]: TypeError: 'persistent_load' is an invalid keyword argument for load()

[rank0]: During handling of the above exception, another exception occurred:

[rank0]: Traceback (most recent call last):
[rank0]:   File "/Users/robmills/audio-translation/Backend/diff2lip/guided_diffusion/dist_util.py", line 94, in load_state_dict
[rank0]:     return th.load(io.BytesIO(data), 
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1111, in load
[rank0]:     return _legacy_load(opened_file, map_location, _weights_only_unpickler, **pickle_load_args)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1338, in _legacy_load
[rank0]:     magic_number = pickle_module.load(f, **pickle_load_args)
[rank0]:                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/_weights_only_unpickler.py", line 383, in load
[rank0]:     return Unpickler(file, encoding=encoding).load()
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/_weights_only_unpickler.py", line 342, in load
[rank0]:     self.append(self.persistent_load(pid))
[rank0]:                 ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/_weights_only_unpickler.py", line 379, in persistent_load
[rank0]:     raise UnpicklingError("unsupported persistent id encountered")
[rank0]: _pickle.UnpicklingError: unsupported persistent id encountered

[rank0]: During handling of the above exception, another exception occurred:

[rank0]: Traceback (most recent call last):
[rank0]:   File "/Users/robmills/audio-translation/Backend/diff2lip/generate.py", line 403, in <module>
[rank0]:     main()
[rank0]:   File "/Users/robmills/audio-translation/Backend/diff2lip/generate.py", line 329, in main
[rank0]:     dist_util.load_state_dict(args.model_path, map_location='cpu')
[rank0]:   File "/Users/robmills/audio-translation/Backend/diff2lip/guided_diffusion/dist_util.py", line 105, in load_state_dict
[rank0]:     return th.load(io.BytesIO(data), 
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1114, in load
[rank0]:     return _legacy_load(
[rank0]:            ^^^^^^^^^^^^^
[rank0]:   File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1338, in _legacy_load
[rank0]:     magic_number = pickle_module.load(f, **pickle_load_args)
[rank0]:                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]: _pickle.UnpicklingError: A load persistent id instruction was encountered, but no persistent_load function was specified.

2025-02-27 00:05:47,299 - services.video_routes - WARNING - [video_routes.py:373] - Diff2Lip sync failed, falling back to basic audio sync
2025-02-27 08:46:34,319 - __main__ - INFO - [app.py:218] - Received SIGINT signal
2025-02-27 08:46:34,320 - __main__ - INFO - [app.py:203] - Initiating graceful shutdown...
2025-02-27 08:46:39,326 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-27 08:46:39,327 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-27 08:46:39,328 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-27 08:46:39,330 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-27 08:46:39,331 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-27 08:46:39,331 - __main__ - INFO - [app.py:207] - Graceful shutdown completed
2025-02-27 08:46:39,333 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-27 08:46:39,333 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-27 08:46:39,334 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-27 08:46:39,334 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-27 08:46:39,335 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-27 08:46:39,335 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-27 08:46:39,336 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-27 08:46:39,336 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-27 08:46:39,337 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-27 08:46:39,338 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-27 08:47:57,596 - __main__ - INFO - [app.py:481] - Metrics server started on port 8000
2025-02-27 08:47:57,597 - services.model_manager - INFO - [model_manager.py:120] - Loading SeamlessM4T model: facebook/seamless-m4t-v2-large
2025-02-27 08:48:10,866 - services.model_manager - INFO - [model_manager.py:184] - Models loaded on CPU
2025-02-27 08:48:10,867 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-27 08:48:10,867 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-27 08:48:29,375 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-27 08:48:29,376 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-27 08:48:49,921 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-27 08:48:49,921 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-27 08:48:49,924 - services.model_manager - INFO - [model_manager.py:190] - Model initialization successful
2025-02-27 08:48:49,924 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-27 08:48:49,924 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-27 08:49:11,597 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-27 08:49:11,598 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-27 08:49:27,927 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-27 08:49:27,927 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:505] - ==================================================
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:506] - Starting LinguaSync Backend
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:507] - Starting Flask app on port 5001 using cpu
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:508] - Python version: 3.12.4 | packaged by Anaconda, Inc. | (main, Jun 18 2024, 10:07:17) [Clang 14.0.6 ]
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:509] - Supported languages: ['fra', 'spa', 'deu', 'ita', 'por']
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:510] - Maximum audio length: 300 seconds
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:511] - Sample rate: 16000 Hz
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:515] - System memory: 36.0GB total, 14.9GB available
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:516] - CPU cores: 11
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:524] - Configuration:
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:525] - - Debug mode: False
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:526] - - CORS enabled: True
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:527] - - Rate limiting: 10 requests per minute
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:528] - - Metrics enabled: True (port 8000)
2025-02-27 08:49:27,931 - __main__ - INFO - [app.py:530] - ==================================================
2025-02-27 08:50:17,338 - services.diagnostics.spectral_analysis - INFO - [spectral_analysis.py:59] - Initialized SpectralAnalyzer with sample rate: 16000Hz
2025-02-27 08:50:17,338 - services.diagnostics.base - INFO - [base.py:75] - AudioDiagnostics initialized successfully
2025-02-27 08:50:17,338 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-27 08:50:17,339 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-27 08:50:39,554 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-27 08:50:39,555 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-27 08:50:56,751 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-27 08:50:56,752 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-27 08:50:56,756 - services.utils - INFO - [utils.py:57] - Performance - Function: process_video, Duration: 39.42s, Memory Change: 14.39MB
2025-02-27 08:50:56,756 - __main__ - INFO - [app.py:279] - Request to /process-video took 39.42s
2025-02-27 08:50:57,622 - services.video_routes - INFO - [video_routes.py:339] - Detected speech starts at: 0.54 seconds
2025-02-27 08:50:57,622 - services.audio_processor - INFO - [audio_processor.py:280] - Loading audio from: temp/temp_audio.wav
2025-02-27 08:50:57,622 - services.audio_processor - INFO - [audio_processor.py:282] - Audio info - Sample rate: 16000, Channels: 1
2025-02-27 08:50:57,624 - services.audio_processor - INFO - [audio_processor.py:291] - Original audio shape: torch.Size([1, 223260]), Frequency: 16000Hz
2025-02-27 08:50:57,650 - services.video_routes - INFO - [video_routes.py:117] - Generating text translation in fra
2025-02-27 08:51:05,502 - services.video_routes - INFO - [video_routes.py:126] - Generated text: Ok, c'est un test, voyons si nous pouvons traduire cette vidéo et aussi faire une synchronisation des lèvres.
2025-02-27 08:51:05,502 - services.video_routes - INFO - [video_routes.py:129] - Generating translated speech
2025-02-27 08:51:11,044 - services.video_routes - INFO - [video_routes.py:157] - Translation successful, audio shape: torch.Size([1, 81280])
2025-02-27 08:51:14,021 - services.video_routes - INFO - [video_routes.py:249] - Face detected with bounding box: (641, 245, 1057, 834)
2025-02-27 08:51:14,055 - services.video_routes - ERROR - [video_routes.py:283] - Model pre-check failed:   File "<string>", line 2
    import sys
IndentationError: unexpected indent

2025-02-27 08:51:14,056 - services.video_routes - WARNING - [video_routes.py:376] - Diff2Lip sync failed, falling back to basic audio sync
2025-02-27 09:14:46,744 - __main__ - INFO - [app.py:218] - Received SIGINT signal
2025-02-27 09:14:46,745 - __main__ - INFO - [app.py:203] - Initiating graceful shutdown...
2025-02-27 09:14:51,748 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-27 09:14:51,749 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-27 09:14:51,750 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-27 09:14:51,752 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-27 09:14:51,753 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-27 09:14:51,754 - __main__ - INFO - [app.py:207] - Graceful shutdown completed
2025-02-27 09:14:51,755 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-27 09:14:51,755 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-27 09:14:51,755 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-27 09:14:51,757 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-27 09:14:51,757 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-27 09:14:51,758 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-27 09:14:51,758 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-27 09:14:51,758 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-27 09:14:51,759 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-27 09:14:51,759 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-27 09:15:09,351 - __main__ - INFO - [app.py:481] - Metrics server started on port 8000
2025-02-27 09:15:09,351 - services.model_manager - INFO - [model_manager.py:120] - Loading SeamlessM4T model: facebook/seamless-m4t-v2-large
2025-02-27 09:15:22,945 - services.model_manager - INFO - [model_manager.py:184] - Models loaded on CPU
2025-02-27 09:15:22,945 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-27 09:15:22,945 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-27 09:15:43,779 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-27 09:15:43,779 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-27 09:16:02,682 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-27 09:16:02,683 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-27 09:16:02,685 - services.model_manager - INFO - [model_manager.py:190] - Model initialization successful
2025-02-27 09:16:02,685 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-27 09:16:02,685 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-27 09:16:23,868 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-27 09:16:23,868 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-27 09:16:45,073 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-27 09:16:45,073 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-27 09:16:45,077 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-27 09:16:45,077 - __main__ - INFO - [app.py:505] - ==================================================
2025-02-27 09:16:45,077 - __main__ - INFO - [app.py:506] - Starting LinguaSync Backend
2025-02-27 09:16:45,077 - __main__ - INFO - [app.py:507] - Starting Flask app on port 5001 using cpu
2025-02-27 09:16:45,077 - __main__ - INFO - [app.py:508] - Python version: 3.12.4 | packaged by Anaconda, Inc. | (main, Jun 18 2024, 10:07:17) [Clang 14.0.6 ]
2025-02-27 09:16:45,077 - __main__ - INFO - [app.py:509] - Supported languages: ['fra', 'spa', 'deu', 'ita', 'por']
2025-02-27 09:16:45,077 - __main__ - INFO - [app.py:510] - Maximum audio length: 300 seconds
2025-02-27 09:16:45,077 - __main__ - INFO - [app.py:511] - Sample rate: 16000 Hz
2025-02-27 09:16:45,078 - __main__ - INFO - [app.py:515] - System memory: 36.0GB total, 16.5GB available
2025-02-27 09:16:45,078 - __main__ - INFO - [app.py:516] - CPU cores: 11
2025-02-27 09:16:45,078 - __main__ - INFO - [app.py:524] - Configuration:
2025-02-27 09:16:45,078 - __main__ - INFO - [app.py:525] - - Debug mode: False
2025-02-27 09:16:45,078 - __main__ - INFO - [app.py:526] - - CORS enabled: True
2025-02-27 09:16:45,078 - __main__ - INFO - [app.py:527] - - Rate limiting: 10 requests per minute
2025-02-27 09:16:45,078 - __main__ - INFO - [app.py:528] - - Metrics enabled: True (port 8000)
2025-02-27 09:16:45,078 - __main__ - INFO - [app.py:530] - ==================================================
2025-02-27 09:18:11,258 - services.diagnostics.spectral_analysis - INFO - [spectral_analysis.py:59] - Initialized SpectralAnalyzer with sample rate: 16000Hz
2025-02-27 09:18:11,258 - services.diagnostics.base - INFO - [base.py:75] - AudioDiagnostics initialized successfully
2025-02-27 09:18:11,258 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-27 09:18:11,258 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-27 09:18:31,607 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-27 09:18:31,607 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-27 09:18:47,422 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-27 09:18:47,422 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-27 09:18:47,424 - services.utils - INFO - [utils.py:57] - Performance - Function: process_video, Duration: 36.17s, Memory Change: 25.59MB
2025-02-27 09:18:47,424 - __main__ - INFO - [app.py:279] - Request to /process-video took 36.17s
2025-02-27 09:18:47,580 - services.video_routes - INFO - [video_routes.py:339] - Detected speech starts at: 0.54 seconds
2025-02-27 09:18:47,580 - services.audio_processor - INFO - [audio_processor.py:280] - Loading audio from: temp/temp_audio.wav
2025-02-27 09:18:47,580 - services.audio_processor - INFO - [audio_processor.py:282] - Audio info - Sample rate: 16000, Channels: 1
2025-02-27 09:18:47,581 - services.audio_processor - INFO - [audio_processor.py:291] - Original audio shape: torch.Size([1, 223260]), Frequency: 16000Hz
2025-02-27 09:18:47,617 - services.video_routes - INFO - [video_routes.py:117] - Generating text translation in fra
2025-02-27 09:18:55,465 - services.video_routes - INFO - [video_routes.py:126] - Generated text: Ok, c'est un test, voyons si nous pouvons traduire cette vidéo et aussi faire une synchronisation des lèvres.
2025-02-27 09:18:55,465 - services.video_routes - INFO - [video_routes.py:129] - Generating translated speech
2025-02-27 09:19:01,469 - services.video_routes - INFO - [video_routes.py:157] - Translation successful, audio shape: torch.Size([1, 81280])
2025-02-27 09:19:04,514 - services.video_routes - INFO - [video_routes.py:249] - Face detected with bounding box: (641, 245, 1057, 834)
2025-02-27 09:19:05,304 - services.video_routes - ERROR - [video_routes.py:283] - Model pre-check failed: Custom model loading failed: 'tuple' object has no attribute 'dtype'
/Users/robmills/audio-translation/Backend/diff2lip_loader.py:40: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  return torch.load(model_path, map_location=map_location)
Traceback (most recent call last):
  File "/Users/robmills/audio-translation/Backend/diff2lip_loader.py", line 32, in custom_load_model
    model_dict = unpickler.load()
                 ^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/torch/_utils.py", line 200, in _rebuild_tensor_v2
    tensor = _rebuild_tensor(storage, storage_offset, size, stride)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/torch/_utils.py", line 178, in _rebuild_tensor
    t = torch.empty((0,), dtype=storage.dtype, device=storage._untyped_storage.device)
                                ^^^^^^^^^^^^^
AttributeError: 'tuple' object has no attribute 'dtype'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<string>", line 6, in <module>
  File "/Users/robmills/audio-translation/Backend/diff2lip_loader.py", line 40, in custom_load_model
    return torch.load(model_path, map_location=map_location)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1114, in load
    return _legacy_load(
           ^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/torch/serialization.py", line 1338, in _legacy_load
    magic_number = pickle_module.load(f, **pickle_load_args)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_pickle.UnpicklingError: A load persistent id instruction was encountered, but no persistent_load function was specified.

2025-02-27 09:19:05,305 - services.video_routes - WARNING - [video_routes.py:376] - Diff2Lip sync failed, falling back to basic audio sync
