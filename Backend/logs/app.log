2025-02-28 08:03:49,959 - __main__ - INFO - [app.py:218] - Received SIGINT signal
2025-02-28 08:03:49,964 - __main__ - INFO - [app.py:203] - Initiating graceful shutdown...
2025-02-28 08:03:54,967 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-28 08:03:54,969 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-28 08:03:54,969 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-28 08:03:54,972 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-28 08:03:54,973 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-28 08:03:54,974 - __main__ - INFO - [app.py:207] - Graceful shutdown completed
2025-02-28 08:03:54,976 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-28 08:03:54,977 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-28 08:03:54,977 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-28 08:03:54,979 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-28 08:03:54,979 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-28 08:03:54,980 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-28 08:03:54,980 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-28 08:03:54,980 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-28 08:03:54,981 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-28 08:03:54,982 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-28 09:34:19,225 - __main__ - INFO - [app.py:481] - Metrics server started on port 8000
2025-02-28 09:34:19,225 - services.model_manager - INFO - [model_manager.py:120] - Loading SeamlessM4T model: facebook/seamless-m4t-v2-large
2025-02-28 09:34:31,810 - services.model_manager - INFO - [model_manager.py:184] - Models loaded on CPU
2025-02-28 09:34:31,810 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-28 09:34:31,813 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-28 09:34:59,090 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-28 09:34:59,091 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-28 09:35:16,526 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-28 09:35:16,527 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-28 09:35:16,528 - services.model_manager - INFO - [model_manager.py:190] - Model initialization successful
2025-02-28 09:35:16,528 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-28 09:35:16,529 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-28 09:35:29,800 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-28 09:35:29,800 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-28 09:35:44,868 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-28 09:35:44,868 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:505] - ==================================================
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:506] - Starting LinguaSync Backend
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:507] - Starting Flask app on port 5001 using cpu
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:508] - Python version: 3.12.4 | packaged by Anaconda, Inc. | (main, Jun 18 2024, 10:07:17) [Clang 14.0.6 ]
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:509] - Supported languages: ['fra', 'spa', 'deu', 'ita', 'por']
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:510] - Maximum audio length: 300 seconds
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:511] - Sample rate: 16000 Hz
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:515] - System memory: 36.0GB total, 14.2GB available
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:516] - CPU cores: 11
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:524] - Configuration:
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:525] - - Debug mode: False
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:526] - - CORS enabled: True
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:527] - - Rate limiting: 10 requests per minute
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:528] - - Metrics enabled: True (port 8000)
2025-02-28 09:35:44,872 - __main__ - INFO - [app.py:530] - ==================================================
2025-02-28 09:37:10,593 - services.diagnostics.spectral_analysis - INFO - [spectral_analysis.py:59] - Initialized SpectralAnalyzer with sample rate: 16000Hz
2025-02-28 09:37:10,593 - services.diagnostics.base - INFO - [base.py:75] - AudioDiagnostics initialized successfully
2025-02-28 09:37:10,593 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-28 09:37:10,594 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-28 09:37:26,739 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-28 09:37:26,739 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-28 09:37:44,747 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-28 09:37:44,747 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-28 09:37:44,750 - services.utils - INFO - [utils.py:57] - Performance - Function: process_video, Duration: 34.16s, Memory Change: 270.45MB
2025-02-28 09:37:44,751 - __main__ - INFO - [app.py:279] - Request to /process-video took 34.16s
2025-02-28 09:37:46,753 - services.video_routes - INFO - [video_routes.py:368] - Detected speech starts at: 0.54 seconds
2025-02-28 09:37:46,753 - services.audio_processor - INFO - [audio_processor.py:280] - Loading audio from: temp/temp_audio.wav
2025-02-28 09:37:46,753 - services.audio_processor - INFO - [audio_processor.py:282] - Audio info - Sample rate: 16000, Channels: 1
2025-02-28 09:37:46,756 - services.audio_processor - INFO - [audio_processor.py:291] - Original audio shape: torch.Size([1, 223260]), Frequency: 16000Hz
2025-02-28 09:37:46,798 - services.video_routes - INFO - [video_routes.py:117] - Generating text translation in fra
2025-02-28 09:37:54,422 - services.video_routes - INFO - [video_routes.py:126] - Generated text: Ok, c'est un test, voyons si nous pouvons traduire cette vidéo et aussi faire une synchronisation des lèvres.
2025-02-28 09:37:54,422 - services.video_routes - INFO - [video_routes.py:129] - Generating translated speech
2025-02-28 09:37:59,821 - services.video_routes - INFO - [video_routes.py:157] - Translation successful, audio shape: torch.Size([1, 81280])
2025-02-28 09:38:02,847 - services.video_routes - INFO - [video_routes.py:249] - Face detected with bounding box: (641, 245, 1057, 834)
2025-02-28 09:38:02,849 - services.video_routes - INFO - [video_routes.py:258] - Starting lip sync with Wav2Lip: /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpexk4cu26.mp4 + temp/translated_audio.wav
2025-02-28 09:38:02,849 - services.video_routes - INFO - [video_routes.py:296] - Running Wav2Lip with command: python Wav2Lip/inference.py --checkpoint_path Wav2Lip/checkpoints/wav2lip.pth --face /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpexk4cu26.mp4 --audio temp/translated_audio.wav --outfile temp/synced_video.mp4 --nosmooth --pads 0 20 0 0
2025-02-28 09:38:09,095 - services.video_routes - ERROR - [video_routes.py:309] - Wav2Lip process failed with return code 1: Traceback (most recent call last):
  File "/Users/robmills/audio-translation/Backend/Wav2Lip/inference.py", line 280, in <module>
    main()
  File "/Users/robmills/audio-translation/Backend/Wav2Lip/inference.py", line 225, in main
    mel = audio.melspectrogram(wav)
          ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/robmills/audio-translation/Backend/Wav2Lip/audio.py", line 47, in melspectrogram
    S = _amp_to_db(_linear_to_mel(np.abs(D))) - hp.ref_level_db
                   ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/robmills/audio-translation/Backend/Wav2Lip/audio.py", line 95, in _linear_to_mel
    _mel_basis = _build_mel_basis()
                 ^^^^^^^^^^^^^^^^^^
  File "/Users/robmills/audio-translation/Backend/Wav2Lip/audio.py", line 100, in _build_mel_basis
    return librosa.filters.mel(hp.sample_rate, hp.n_fft, n_mels=hp.num_mels,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: mel() takes 0 positional arguments but 2 positional arguments (and 3 keyword-only arguments) were given

2025-02-28 09:38:09,096 - services.video_routes - WARNING - [video_routes.py:405] - Wav2Lip sync failed, falling back to basic audio sync
2025-02-28 10:00:15,613 - __main__ - INFO - [app.py:218] - Received SIGINT signal
2025-02-28 10:00:15,614 - __main__ - INFO - [app.py:203] - Initiating graceful shutdown...
2025-02-28 10:00:20,619 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-28 10:00:20,619 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-28 10:00:20,619 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-28 10:00:20,620 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-28 10:00:20,620 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-28 10:00:20,620 - __main__ - INFO - [app.py:207] - Graceful shutdown completed
2025-02-28 10:00:20,621 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-28 10:00:20,621 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-28 10:00:20,621 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-28 10:00:20,621 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-28 10:00:20,621 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-28 10:00:20,621 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-28 10:00:20,621 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-28 10:00:20,621 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-28 10:00:20,622 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-28 10:00:20,622 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-28 10:00:33,577 - __main__ - INFO - [app.py:481] - Metrics server started on port 8000
2025-02-28 10:00:33,577 - services.model_manager - INFO - [model_manager.py:120] - Loading SeamlessM4T model: facebook/seamless-m4t-v2-large
2025-02-28 10:00:46,238 - services.model_manager - INFO - [model_manager.py:184] - Models loaded on CPU
2025-02-28 10:00:46,238 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-28 10:00:46,239 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-28 10:01:03,724 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-28 10:01:03,724 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-28 10:01:19,475 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-28 10:01:19,475 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-28 10:01:19,477 - services.model_manager - INFO - [model_manager.py:190] - Model initialization successful
2025-02-28 10:01:19,477 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-28 10:01:19,478 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-28 10:01:34,348 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-28 10:01:34,348 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-28 10:01:51,909 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-28 10:01:51,910 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:505] - ==================================================
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:506] - Starting LinguaSync Backend
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:507] - Starting Flask app on port 5001 using cpu
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:508] - Python version: 3.12.4 | packaged by Anaconda, Inc. | (main, Jun 18 2024, 10:07:17) [Clang 14.0.6 ]
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:509] - Supported languages: ['fra', 'spa', 'deu', 'ita', 'por']
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:510] - Maximum audio length: 300 seconds
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:511] - Sample rate: 16000 Hz
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:515] - System memory: 36.0GB total, 15.5GB available
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:516] - CPU cores: 11
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:524] - Configuration:
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:525] - - Debug mode: False
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:526] - - CORS enabled: True
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:527] - - Rate limiting: 10 requests per minute
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:528] - - Metrics enabled: True (port 8000)
2025-02-28 10:01:51,913 - __main__ - INFO - [app.py:530] - ==================================================
2025-02-28 10:02:22,855 - services.diagnostics.spectral_analysis - INFO - [spectral_analysis.py:59] - Initialized SpectralAnalyzer with sample rate: 16000Hz
2025-02-28 10:02:22,856 - services.diagnostics.base - INFO - [base.py:75] - AudioDiagnostics initialized successfully
2025-02-28 10:02:22,856 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-28 10:02:22,857 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-28 10:02:38,160 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-28 10:02:38,160 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-28 10:02:56,155 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-28 10:02:56,155 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-28 10:02:56,158 - services.utils - INFO - [utils.py:57] - Performance - Function: process_video, Duration: 33.30s, Memory Change: 29.98MB
2025-02-28 10:02:56,158 - __main__ - INFO - [app.py:279] - Request to /process-video took 33.30s
2025-02-28 10:02:57,646 - services.video_routes - INFO - [video_routes.py:368] - Detected speech starts at: 0.54 seconds
2025-02-28 10:02:57,647 - services.audio_processor - INFO - [audio_processor.py:280] - Loading audio from: temp/temp_audio.wav
2025-02-28 10:02:57,647 - services.audio_processor - INFO - [audio_processor.py:282] - Audio info - Sample rate: 16000, Channels: 1
2025-02-28 10:02:57,647 - services.audio_processor - INFO - [audio_processor.py:291] - Original audio shape: torch.Size([1, 223260]), Frequency: 16000Hz
2025-02-28 10:02:57,676 - services.video_routes - INFO - [video_routes.py:117] - Generating text translation in fra
2025-02-28 10:03:05,031 - services.video_routes - INFO - [video_routes.py:126] - Generated text: Ok, c'est un test, voyons si nous pouvons traduire cette vidéo et aussi faire une synchronisation des lèvres.
2025-02-28 10:03:05,031 - services.video_routes - INFO - [video_routes.py:129] - Generating translated speech
2025-02-28 10:03:10,502 - services.video_routes - INFO - [video_routes.py:157] - Translation successful, audio shape: torch.Size([1, 81280])
2025-02-28 10:03:13,384 - services.video_routes - INFO - [video_routes.py:249] - Face detected with bounding box: (641, 245, 1057, 834)
2025-02-28 10:03:13,385 - services.video_routes - INFO - [video_routes.py:258] - Starting lip sync with Wav2Lip: /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpu32h81bb.mp4 + temp/translated_audio.wav
2025-02-28 10:03:13,385 - services.video_routes - INFO - [video_routes.py:296] - Running Wav2Lip with command: python Wav2Lip/inference.py --checkpoint_path Wav2Lip/checkpoints/wav2lip.pth --face /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpu32h81bb.mp4 --audio temp/translated_audio.wav --outfile temp/synced_video.mp4 --nosmooth --pads 0 20 0 0
2025-02-28 10:10:15,474 - services.video_routes - ERROR - [video_routes.py:345] - Wav2Lip process timed out after 5 minutes
2025-02-28 10:10:15,476 - services.video_routes - WARNING - [video_routes.py:405] - Wav2Lip sync failed, falling back to basic audio sync
2025-02-28 10:24:20,040 - __main__ - INFO - [app.py:218] - Received SIGINT signal
2025-02-28 10:24:20,043 - __main__ - INFO - [app.py:203] - Initiating graceful shutdown...
2025-02-28 10:24:25,048 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-28 10:24:25,050 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-28 10:24:25,051 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-28 10:24:25,053 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-28 10:24:25,055 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-28 10:24:25,055 - __main__ - INFO - [app.py:207] - Graceful shutdown completed
2025-02-28 10:24:25,057 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-28 10:24:25,057 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-28 10:24:25,057 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-28 10:24:25,058 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-28 10:24:25,058 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-28 10:24:25,059 - __main__ - INFO - [app.py:450] - Application shutting down...
2025-02-28 10:24:25,060 - services.model_manager - INFO - [model_manager.py:233] - Cleaning up model resources
2025-02-28 10:24:25,060 - services.model_manager - INFO - [model_manager.py:246] - Model cleanup completed successfully
2025-02-28 10:24:25,061 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-28 10:24:25,061 - __main__ - INFO - [app.py:464] - Cleanup completed successfully
2025-02-28 10:24:48,240 - __main__ - INFO - [app.py:481] - Metrics server started on port 8000
2025-02-28 10:24:48,240 - services.model_manager - INFO - [model_manager.py:120] - Loading SeamlessM4T model: facebook/seamless-m4t-v2-large
2025-02-28 10:25:01,272 - services.model_manager - INFO - [model_manager.py:184] - Models loaded on CPU
2025-02-28 10:25:01,272 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-28 10:25:01,275 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-28 10:25:25,790 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-28 10:25:25,791 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-28 10:25:45,103 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-28 10:25:45,103 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-28 10:25:45,106 - services.model_manager - INFO - [model_manager.py:190] - Model initialization successful
2025-02-28 10:25:45,106 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-28 10:25:45,106 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-28 10:25:59,261 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-28 10:25:59,262 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-28 10:26:14,420 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-28 10:26:14,420 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:432] - Cleanup complete: removed 0 files, freed 0.00MB
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:505] - ==================================================
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:506] - Starting LinguaSync Backend
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:507] - Starting Flask app on port 5001 using cpu
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:508] - Python version: 3.12.4 | packaged by Anaconda, Inc. | (main, Jun 18 2024, 10:07:17) [Clang 14.0.6 ]
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:509] - Supported languages: ['fra', 'spa', 'deu', 'ita', 'por']
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:510] - Maximum audio length: 300 seconds
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:511] - Sample rate: 16000 Hz
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:515] - System memory: 36.0GB total, 16.6GB available
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:516] - CPU cores: 11
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:524] - Configuration:
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:525] - - Debug mode: False
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:526] - - CORS enabled: True
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:527] - - Rate limiting: 10 requests per minute
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:528] - - Metrics enabled: True (port 8000)
2025-02-28 10:26:14,423 - __main__ - INFO - [app.py:530] - ==================================================
2025-02-28 10:26:41,051 - services.video_routes - INFO - [video_routes.py:890] - Received video processing request for language: fra
2025-02-28 10:26:41,051 - services.video_routes - INFO - [video_routes.py:901] - Processing video: Movie on 20-02-2025 at 20.44.mov for language: fra
2025-02-28 10:26:41,051 - services.video_routes - INFO - [video_routes.py:32] - Initializing VideoProcessor
2025-02-28 10:26:41,051 - services.diagnostics.spectral_analysis - INFO - [spectral_analysis.py:59] - Initialized SpectralAnalyzer with sample rate: 16000Hz
2025-02-28 10:26:41,051 - services.diagnostics.base - INFO - [base.py:75] - AudioDiagnostics initialized successfully
2025-02-28 10:26:41,051 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-28 10:26:41,052 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-28 10:27:00,891 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-28 10:27:00,892 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-28 10:27:19,761 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-28 10:27:19,761 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-28 10:27:19,766 - services.video_routes - INFO - [video_routes.py:37] - Using device: cpu
2025-02-28 10:27:19,766 - services.video_routes - INFO - [video_routes.py:42] - Temp directory: temp
2025-02-28 10:27:19,766 - services.video_routes - INFO - [video_routes.py:49] - Checking Wav2Lip setup...
2025-02-28 10:27:19,766 - services.video_routes - INFO - [video_routes.py:56] - Wav2Lip directory found: /Users/robmills/audio-translation/Backend/Wav2Lip
2025-02-28 10:27:19,766 - services.video_routes - INFO - [video_routes.py:71] - ✓ Inference script found: Wav2Lip/inference.py (9750 bytes)
2025-02-28 10:27:19,766 - services.video_routes - INFO - [video_routes.py:71] - ✓ Audio processing module found: Wav2Lip/audio.py (4508 bytes)
2025-02-28 10:27:19,766 - services.video_routes - INFO - [video_routes.py:71] - ✓ Face detection API found: Wav2Lip/face_detection/api.py (2266 bytes)
2025-02-28 10:27:19,766 - services.video_routes - INFO - [video_routes.py:71] - ✓ Face detection model found: Wav2Lip/face_detection/detection/sfd/s3fd.pth (89843225 bytes)
2025-02-28 10:27:19,766 - services.video_routes - INFO - [video_routes.py:71] - ✓ Primary model checkpoint found: Wav2Lip/checkpoints/wav2lip.pth (435807851 bytes)
2025-02-28 10:27:19,766 - services.video_routes - WARNING - [video_routes.py:73] - ✗ GAN model checkpoint (optional) not found: Wav2Lip/checkpoints/wav2lip_gan.pth
2025-02-28 10:27:19,767 - services.utils - INFO - [utils.py:57] - Performance - Function: process_video, Duration: 38.72s, Memory Change: 53.78MB
2025-02-28 10:27:19,767 - __main__ - INFO - [app.py:279] - Request to /process-video took 38.72s
2025-02-28 10:27:19,767 - services.video_routes - INFO - [video_routes.py:720] - Starting video processing for language: fra
2025-02-28 10:27:19,767 - services.video_routes - INFO - [video_routes.py:725] - Input video filename: Movie on 20-02-2025 at 20.44.mov, content type: video/quicktime
2025-02-28 10:27:19,776 - services.video_routes - INFO - [video_routes.py:734] - Saved uploaded video (size: 20861521 bytes)
2025-02-28 10:27:19,777 - services.video_routes - INFO - [video_routes.py:82] - Extracting audio from /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpmgpa3y0k.mp4
2025-02-28 10:27:19,777 - services.video_routes - INFO - [video_routes.py:94] - Running FFmpeg command: ffmpeg -y -i /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpmgpa3y0k.mp4 -vn -acodec pcm_s16le -ar 16000 -ac 1 temp/temp_audio.wav
2025-02-28 10:27:19,856 - services.video_routes - INFO - [video_routes.py:105] - Audio successfully extracted to temp/temp_audio.wav (size: 446598 bytes)
2025-02-28 10:27:19,856 - services.video_routes - INFO - [video_routes.py:341] - Detecting speech start in temp/temp_audio.wav
2025-02-28 10:27:19,859 - services.video_routes - INFO - [video_routes.py:383] - Detected speech start at 0.540 seconds
2025-02-28 10:27:19,859 - services.video_routes - INFO - [video_routes.py:749] - Detected speech starts at: 0.54 seconds
2025-02-28 10:27:19,859 - services.audio_processor - INFO - [audio_processor.py:280] - Loading audio from: temp/temp_audio.wav
2025-02-28 10:27:19,860 - services.audio_processor - INFO - [audio_processor.py:282] - Audio info - Sample rate: 16000, Channels: 1
2025-02-28 10:27:19,860 - services.audio_processor - INFO - [audio_processor.py:291] - Original audio shape: torch.Size([1, 223260]), Frequency: 16000Hz
2025-02-28 10:27:19,871 - services.video_routes - INFO - [video_routes.py:184] - Translating audio of shape torch.Size([1, 223232]) to language fra
2025-02-28 10:27:19,885 - services.video_routes - INFO - [video_routes.py:209] - Generating text translation in fra
2025-02-28 10:27:27,378 - services.video_routes - INFO - [video_routes.py:218] - Generated text: Ok, c'est un test, voyons si nous pouvons traduire cette vidéo et aussi faire une synchronisation des lèvres.
2025-02-28 10:27:27,378 - services.video_routes - INFO - [video_routes.py:221] - Generating translated speech for language fra
2025-02-28 10:27:32,767 - services.video_routes - INFO - [video_routes.py:233] - Speech generation completed in 5.39 seconds
2025-02-28 10:27:32,767 - services.video_routes - INFO - [video_routes.py:262] - Translation successful, audio shape: torch.Size([1, 81280])
2025-02-28 10:27:32,768 - services.video_routes - INFO - [video_routes.py:765] - Translation completed in 12.90 seconds
2025-02-28 10:27:32,768 - services.video_routes - INFO - [video_routes.py:155] - Saving audio tensor of shape torch.Size([1, 81280]) to temp/translated_audio.wav
2025-02-28 10:27:32,769 - services.video_routes - INFO - [video_routes.py:175] - Audio saved successfully to temp/translated_audio.wav (size: 162604 bytes)
2025-02-28 10:27:32,769 - services.video_routes - INFO - [video_routes.py:392] - Detecting face in /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpmgpa3y0k.mp4
2025-02-28 10:27:35,120 - services.video_routes - INFO - [video_routes.py:458] - Selected face detected with bounding box: (641, 245, 1057, 834)
2025-02-28 10:27:35,122 - services.video_routes - INFO - [video_routes.py:785] - Face detection completed in 2.35 seconds, result: True
2025-02-28 10:27:35,122 - services.video_routes - INFO - [video_routes.py:800] - Attempting lip sync with Wav2Lip
2025-02-28 10:27:35,122 - services.video_routes - INFO - [video_routes.py:467] - Starting lip sync with Wav2Lip: /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpmgpa3y0k.mp4 + temp/translated_audio.wav
2025-02-28 10:27:35,346 - services.video_routes - INFO - [video_routes.py:564] - Running Wav2Lip with command: python Wav2Lip/inference.py --checkpoint_path Wav2Lip/checkpoints/wav2lip.pth --face /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpmgpa3y0k.mp4 --audio temp/translated_audio.wav --outfile temp/synced_video.mp4 --nosmooth --pads 0 20 0 0 --resize_factor 1.5
2025-02-28 10:27:36,577 - services.video_routes - ERROR - [video_routes.py:582] - Process stderr: usage: inference.py [-h] --checkpoint_path CHECKPOINT_PATH --face FACE --audio
                    AUDIO [--outfile OUTFILE] [--static STATIC] [--fps FPS]
                    [--pads PADS [PADS ...]]
                    [--face_det_batch_size FACE_DET_BATCH_SIZE]
                    [--wav2lip_batch_size WAV2LIP_BATCH_SIZE]
                    [--resize_factor RESIZE_FACTOR] [--crop CROP [CROP ...]]
                    [--box BOX [BOX ...]] [--rotate] [--nosmooth]
inference.py: error: argument --resize_factor: invalid int value: '1.5'

2025-02-28 10:27:36,577 - services.video_routes - ERROR - [video_routes.py:588] - Wav2Lip process failed with return code 2
2025-02-28 10:27:36,577 - services.video_routes - INFO - [video_routes.py:628] - Trying with different padding values...
2025-02-28 10:27:36,577 - services.video_routes - INFO - [video_routes.py:638] - Running Wav2Lip with alternative parameters: python Wav2Lip/inference.py --checkpoint_path Wav2Lip/checkpoints/wav2lip.pth --face /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpmgpa3y0k.mp4 --audio temp/translated_audio.wav --outfile temp/synced_video.mp4 --nosmooth --pads 10 10 10 10 --resize_factor 2
2025-02-28 10:29:29,097 - services.video_routes - INFO - [video_routes.py:649] - Alt parameters stdout: Using cpu for inference.
Reading video frames...
Number of frames available for inference: 420
(80, 407)
Length of mel chunks: 149
Load checkpoint from: Wav2Lip/checkpoints/wav2lip.pth
Model loaded

2025-02-28 10:29:29,099 - services.video_routes - ERROR - [video_routes.py:651] - Alt parameters stderr: 
  0%|          | 0/2 [00:00<?, ?it/s]/Users/robmills/audio-translation/Backend/Wav2Lip/face_detection/detection/sfd/sfd_detector.py:24: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  model_weights = torch.load(path_to_detector)


  0%|          | 0/10 [00:00<?, ?it/s][A

 10%|█         | 1/10 [00:11<01:43, 11.55s/it][A

 20%|██        | 2/10 [00:22<01:31, 11.48s/it][A

 30%|███       | 3/10 [00:34<01:19, 11.40s/it][A

 40%|████      | 4/10 [00:45<01:08, 11.34s/it][A

 50%|█████     | 5/10 [00:56<00:56, 11.30s/it][A

 60%|██████    | 6/10 [01:08<00:45, 11.32s/it][A

 70%|███████   | 7/10 [01:19<00:33, 11.30s/it][A

 80%|████████  | 8/10 [01:30<00:22, 11.30s/it][A

 90%|█████████ | 9/10 [01:41<00:11, 11.30s/it][A

100%|██████████| 10/10 [01:45<00:00,  8.89s/it][A
100%|██████████| 10/10 [01:45<00:00, 10.55s/it]
/Users/robmills/audio-translation/Backend/Wav2Lip/inference.py:164: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  checkpoint = torch.load(checkpoint_path,

 50%|█████     | 1/2 [01:48<01:48, 108.93s/it]
100%|██████████| 2/2 [01:49<00:00, 45.27s/it] 
100%|██████████| 2/2 [01:49<00:00, 54.82s/it]
ffmpeg version 7.1 Copyright (c) 2000-2024 the FFmpeg developers
  built with Apple clang version 16.0.0 (clang-1600.0.26.4)
  configuration: --prefix=/opt/homebrew/Cellar/ffmpeg/7.1_4 --enable-shared --enable-pthreads --enable-version3 --cc=clang --host-cflags= --host-ldflags='-Wl,-ld_classic' --enable-ffplay --enable-gnutls --enable-gpl --enable-libaom --enable-libaribb24 --enable-libbluray --enable-libdav1d --enable-libharfbuzz --enable-libjxl --enable-libmp3lame --enable-libopus --enable-librav1e --enable-librist --enable-librubberband --enable-libsnappy --enable-libsrt --enable-libssh --enable-libsvtav1 --enable-libtesseract --enable-libtheora --enable-libvidstab --enable-libvmaf --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx264 --enable-libx265 --enable-libxml2 --enable-libxvid --enable-lzma --enable-libfontconfig --enable-libfreetype --enable-frei0r --enable-libass --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libopenjpeg --enable-libspeex --enable-libsoxr --enable-libzmq --enable-libzimg --disable-libjack --disable-indev=jack --enable-videotoolbox --enable-audiotoolbox --enable-neon
  libavutil      59. 39.100 / 59. 39.100
  libavcodec     61. 19.100 / 61. 19.100
  libavformat    61.  7.100 / 61.  7.100
  libavdevice    61.  3.100 / 61.  3.100
  libavfilter    10.  4.100 / 10.  4.100
  libswscale      8.  3.100 /  8.  3.100
  libswresample   5.  3.100 /  5.  3.100
  libpostproc    58.  3.100 / 58.  3.100
[aist#0:0/pcm_s16le @ 0x14b104cb0] Guessed Channel Layout: mono
Input #0, wav, from 'temp/translated_audio.wav':
  Duration: 00:00:05.08, bitrate: 256 kb/s
  Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, mono, s16, 256 kb/s
Input #1, avi, from 'temp/result.avi':
  Metadata:
    software        : Lavf61.7.100
  Duration: 00:00:04.97, start: 0.000000, bitrate: 1577 kb/s
  Stream #1:0: Video: mpeg4 (Simple Profile) (DIVX / 0x58564944), yuv420p, 810x540 [SAR 1:1 DAR 3:2], 1573 kb/s, 30 fps, 30 tbr, 30 tbn
Stream mapping:
  Stream #1:0 -> #0:0 (mpeg4 (native) -> h264 (libx264))
  Stream #0:0 -> #0:1 (pcm_s16le (native) -> aac (native))
Press [q] to stop, [?] for help
[libx264 @ 0x14b109120] -qscale is ignored, -crf is recommended.
[libx264 @ 0x14b109120] using SAR=1/1
[libx264 @ 0x14b109120] using cpu capabilities: ARMv8 NEON
[libx264 @ 0x14b109120] profile High, level 3.1, 4:2:0, 8-bit
[libx264 @ 0x14b109120] 264 - core 164 r3108 31e19f9 - H.264/MPEG-4 AVC codec - Copyleft 2003-2023 - http://www.videolan.org/x264.html - options: cabac=1 ref=3 deblock=1:0:0 analyse=0x3:0x113 me=hex subme=7 psy=1 psy_rd=1.00:0.00 mixed_ref=1 me_range=16 chroma_me=1 trellis=1 8x8dct=1 cqm=0 deadzone=21,11 fast_pskip=1 chroma_qp_offset=-2 threads=16 lookahead_threads=2 sliced_threads=0 nr=0 decimate=1 interlaced=0 bluray_compat=0 constrained_intra=0 bframes=3 b_pyramid=2 b_adapt=1 b_bias=0 direct=1 weightb=1 open_gop=0 weightp=2 keyint=250 keyint_min=25 scenecut=40 intra_refresh=0 rc_lookahead=40 rc=crf mbtree=1 crf=23.0 qcomp=0.60 qpmin=0 qpmax=69 qpstep=4 ip_ratio=1.40 aq=1:1.00
Output #0, mp4, to 'temp/synced_video.mp4':
  Metadata:
    encoder         : Lavf61.7.100
  Stream #0:0: Video: h264 (avc1 / 0x31637661), yuv420p(tv, progressive), 810x540 [SAR 1:1 DAR 3:2], q=2-31, 30 fps, 15360 tbn
      Metadata:
        encoder         : Lavc61.19.100 libx264
      Side data:
        cpb: bitrate max/min/avg: 0/0/0 buffer size: 0 vbv_delay: N/A
  Stream #0:1: Audio: aac (LC) (mp4a / 0x6134706D), 16000 Hz, mono, fltp, 69 kb/s
      Metadata:
        encoder         : Lavc61.19.100 aac
[out#0/mp4 @ 0x14b105db0] video:381KiB audio:48KiB subtitle:0KiB other streams:0KiB global headers:0KiB muxing overhead: 0.951279%
frame=  149 fps=0.0 q=-1.0 Lsize=     433KiB time=00:00:04.90 bitrate= 723.9kbits/s speed=19.5x    
[libx264 @ 0x14b109120] frame I:1     Avg QP:21.51  size: 21612
[libx264 @ 0x14b109120] frame P:67    Avg QP:22.42  size:  4539
[libx264 @ 0x14b109120] frame B:81    Avg QP:24.98  size:   788
[libx264 @ 0x14b109120] consecutive B-frames: 18.8% 25.5%  2.0% 53.7%
[libx264 @ 0x14b109120] mb I  I16..4: 17.0% 81.4%  1.6%
[libx264 @ 0x14b109120] mb P  I16..4:  1.5%  4.5%  0.1%  P16..4: 42.0%  8.2%  4.6%  0.0%  0.0%    skip:39.2%
[libx264 @ 0x14b109120] mb B  I16..4:  0.3%  1.1%  0.0%  B16..8: 26.3%  0.8%  0.1%  direct: 0.2%  skip:71.2%  L0:43.3% L1:55.4% BI: 1.3%
[libx264 @ 0x14b109120] 8x8 transform intra:76.1% inter:83.4%
[libx264 @ 0x14b109120] coded y,uvDC,uvAC intra: 43.4% 57.4% 5.4% inter: 7.3% 12.7% 0.1%
[libx264 @ 0x14b109120] i16 v,h,dc,p: 30% 26% 22% 22%
[libx264 @ 0x14b109120] i8 v,h,dc,ddl,ddr,vr,hd,vl,hu: 29% 17% 43%  2%  2%  3%  2%  2%  1%
[libx264 @ 0x14b109120] i4 v,h,dc,ddl,ddr,vr,hd,vl,hu: 39% 24% 17%  3%  4%  6%  3%  3%  1%
[libx264 @ 0x14b109120] i8c dc,h,v,p: 51% 21% 24%  3%
[libx264 @ 0x14b109120] Weighted P-Frames: Y:0.0% UV:0.0%
[libx264 @ 0x14b109120] ref P L0: 71.7%  8.6% 14.5%  5.3%
[libx264 @ 0x14b109120] ref B L0: 84.9% 12.4%  2.7%
[libx264 @ 0x14b109120] ref B L1: 96.7%  3.3%
[libx264 @ 0x14b109120] kb/s:627.46
[aac @ 0x14b111050] Qavg: 3496.252

2025-02-28 10:29:29,099 - services.video_routes - INFO - [video_routes.py:654] - Wav2Lip successful with alternative parameters!
2025-02-28 10:29:29,099 - services.video_routes - INFO - [video_routes.py:657] - Output file created successfully: temp/synced_video.mp4 (size: 443376 bytes)
2025-02-28 10:29:29,099 - services.video_routes - INFO - [video_routes.py:808] - Lip sync attempt completed in 113.98 seconds, success: True
2025-02-28 10:29:29,099 - services.video_routes - INFO - [video_routes.py:846] - Final video created: temp/synced_video.mp4 (size: 443376 bytes)
2025-02-28 10:29:29,100 - services.video_routes - INFO - [video_routes.py:860] - Encoded video data in 0.00 seconds (length: 591168 characters)
2025-02-28 10:29:29,101 - services.video_routes - INFO - [video_routes.py:866] - Total video processing completed in 129.33 seconds
2025-02-28 11:06:51,437 - services.utils - INFO - [utils.py:57] - Performance - Function: process_audio_url, Duration: 0.00s, Memory Change: 0.22MB
2025-02-28 11:06:51,438 - __main__ - INFO - [app.py:279] - Request to /process-audio-url took 0.00s
2025-02-28 11:06:51,441 - services.audio_link_routes - INFO - [audio_link_routes.py:226] - Processing URL: https://www.tiktok.com/@fightjoe/video/7127311328095522053?lang=en&q=comedy&t=1737721075998
2025-02-28 11:06:51,442 - services.audio_link_routes - INFO - [audio_link_routes.py:246] - Processing TikTok URL
2025-02-28 11:06:51,443 - services.audio_link_routes - INFO - [audio_link_routes.py:130] - Using options for tiktok: {'format': 'bestaudio[ext=m4a]/bestaudio/best', 'outtmpl': '/var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpkl9ozw8n/output', 'quiet': False, 'no_warnings': True, 'keepvideo': True, 'postprocessors': [{'key': 'FFmpegExtractAudio', 'preferredcodec': 'wav', 'preferredquality': '192'}], 'concurrent_fragment_downloads': 8, 'http_headers': {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36', 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'Accept-Language': 'en-us,en;q=0.5', 'Accept-Encoding': 'gzip,deflate', 'Accept-Charset': 'ISO-8859-1,utf-8;q=0.7,*;q=0.7'}, 'nocheckcertificate': True, 'ignoreerrors': False, 'geo_bypass': True, 'extractor_args': {'tiktok': {'api_hostname': 'api22-normal-c-alisg.tiktokv.com', 'app_name': 'trill', 'app_version': '34.1.2', 'manifest_app_version': '2023401020', 'app_info': '1234567890123456789/trill///1180', 'device_id': '6990764255877038994'}}}
2025-02-28 11:06:53,314 - services.audio_link_routes - INFO - [audio_link_routes.py:143] - Successfully downloaded tiktok content
2025-02-28 11:06:53,315 - services.audio_link_routes - INFO - [audio_link_routes.py:162] - Found audio file: /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpkl9ozw8n/output.wav
2025-02-28 11:06:53,320 - services.audio_link_routes - INFO - [audio_link_routes.py:174] - Successfully converted audio to WAV
2025-02-28 11:06:53,320 - services.audio_link_routes - INFO - [audio_link_routes.py:252] - Successfully processed audio
2025-02-28 11:06:53,321 - services.utils - INFO - [utils.py:57] - Performance - Function: process_audio_url, Duration: 1.88s, Memory Change: 87.30MB
2025-02-28 11:06:53,321 - __main__ - INFO - [app.py:279] - Request to /process-audio-url took 1.88s
2025-02-28 11:06:56,404 - services.model_manager - INFO - [model_manager.py:52] - Starting enhanced model verification
2025-02-28 11:06:56,408 - services.model_manager - INFO - [model_manager.py:63] - Testing clean_speech
2025-02-28 11:07:16,309 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified clean_speech
2025-02-28 11:07:16,309 - services.model_manager - INFO - [model_manager.py:63] - Testing speech_with_music
2025-02-28 11:07:33,529 - services.model_manager - INFO - [model_manager.py:108] - Successfully verified speech_with_music
2025-02-28 11:07:33,529 - services.model_manager - INFO - [model_manager.py:110] - Model verification successful
2025-02-28 11:07:33,532 - services.translation_routes - INFO - [translation_routes.py:36] - Starting translation request 45bcfbe6
2025-02-28 11:07:33,532 - services.diagnostics.spectral_analysis - INFO - [spectral_analysis.py:59] - Initialized SpectralAnalyzer with sample rate: 16000Hz
2025-02-28 11:07:33,532 - services.diagnostics.base - INFO - [base.py:75] - AudioDiagnostics initialized successfully
2025-02-28 11:07:33,532 - services.translation_routes - INFO - [translation_routes.py:97] - Request 45bcfbe6: Saved input file: /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpe50ijtch.wav
2025-02-28 11:07:33,533 - services.audio_processor - INFO - [audio_processor.py:136] - Audio duration: 6.57 seconds
2025-02-28 11:07:33,533 - services.translation_routes - INFO - [translation_routes.py:112] - Request 45bcfbe6: Beginning audio processing with diagnostics
2025-02-28 11:07:33,533 - services.audio_processor - INFO - [audio_processor.py:280] - Loading audio from: /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpe50ijtch.wav
2025-02-28 11:07:33,533 - services.audio_processor - INFO - [audio_processor.py:282] - Audio info - Sample rate: 16000, Channels: 1
2025-02-28 11:07:33,534 - services.audio_processor - INFO - [audio_processor.py:291] - Original audio shape: torch.Size([1, 105163]), Frequency: 16000Hz
2025-02-28 11:07:33,540 - services.audio_processor - INFO - [audio_processor.py:449] - Base audio processing successful, proceeding with enhancement
2025-02-28 11:07:33,545 - services.audio_processor - INFO - [audio_processor.py:457] - Background music analysis: {'has_background_music': False, 'music_confidence': 0.15608341036219223, 'feature_scores': {'spectral_flatness': 0.03820588165673722, 'rhythm_regularity': 0.023762376237623763, 'bass_presence': 0.039862824445829455, 'temporal_stability': 0.054252328022001785}, 'speech_vs_music': {'speech_prominence': 7.497730333222908, 'speech_band_energy': 2.2766175789001863e-07, 'music_band_energy': 3.0264089900811086e-08}}
2025-02-28 11:07:33,545 - services.audio_processor - INFO - [audio_processor.py:460] - Applying speech-optimized spectral enhancement for fra
2025-02-28 11:07:33,556 - services.audio_processor - INFO - [audio_processor.py:470] - Analyzing audio quality...
2025-02-28 11:07:33,571 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:363] - Visualization failed: module 'collections' has no attribute 'Iterable'
2025-02-28 11:07:33,574 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:764] - Harmonic analysis failed: mean(): could not infer output dtype. Input dtype must be either a floating point or complex dtype. Got: Long
2025-02-28 11:07:33,579 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:363] - Visualization failed: module 'collections' has no attribute 'Iterable'
2025-02-28 11:07:33,579 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:764] - Harmonic analysis failed: mean(): could not infer output dtype. Input dtype must be either a floating point or complex dtype. Got: Long
2025-02-28 11:07:33,583 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:363] - Visualization failed: module 'collections' has no attribute 'Iterable'
2025-02-28 11:07:33,583 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:764] - Harmonic analysis failed: mean(): could not infer output dtype. Input dtype must be either a floating point or complex dtype. Got: Long
2025-02-28 11:07:33,590 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:363] - Visualization failed: module 'collections' has no attribute 'Iterable'
2025-02-28 11:07:33,590 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:764] - Harmonic analysis failed: mean(): could not infer output dtype. Input dtype must be either a floating point or complex dtype. Got: Long
2025-02-28 11:07:33,739 - services.diagnostics.base - INFO - [base.py:112] - Completed language analysis for fra
2025-02-28 11:07:33,739 - services.translation_routes - INFO - [translation_routes.py:123] - 
==================================================
2025-02-28 11:07:33,739 - services.translation_routes - INFO - [translation_routes.py:124] - Input Audio Quality Report
2025-02-28 11:07:33,739 - services.translation_routes - INFO - [translation_routes.py:125] - ==================================================
2025-02-28 11:07:33,739 - services.translation_routes - INFO - [translation_routes.py:126] - Request ID: 45bcfbe6
2025-02-28 11:07:33,739 - services.translation_routes - INFO - [translation_routes.py:127] - Target Language: fra
2025-02-28 11:07:33,739 - services.translation_routes - INFO - [translation_routes.py:128] - --------------------------------------------------
2025-02-28 11:07:33,739 - services.translation_routes - INFO - [translation_routes.py:129] - Audio Quality Analysis Report
==============================

Target Language: fra

Waveform Analysis:
--------------------
- Peak Amplitude: 0.950
- Avg Amplitude: 0.026
- Rms Level: 0.076
- Crest Factor: 12.530
- Zero Crossings: 29106.000
- Silence Percentage: 62.741
- Clipping Points: 0.000
- Dynamic Range: 6753166.765

- Processing Metrics:
  - Compression Detected: 0.000
  - Over Compressed: 0.000
  - Compression Severity: 0.000
  - Dynamic Range Loss: 0.000

- Temporal Metrics:
  - Smoothing Detected: 1.000
  - Temporal Variation: 0.082
  - Temporal Flatness: 0.024

- Volume Metrics:
  - Volume Stability: -0.671
  - Volume Range: 28777495.027
  - Volume Variations: 0.065

Spectral Analysis:
--------------------

Quality Metrics (1-5 scale):
--------------------
- Robotic Voice: 1.0
- Pronunciation: 1.0
- Audio Clarity: 3.012101101788277
- Background Noise: 5.0
- Voice Consistency: 1.0
- Spectral Balance: 1.0

Detected Issues:
--------------------
- Muffled

Language-Specific Analysis:
--------------------

Nasalization:
  - Nasal Resonance: {'strength': 1.0195544958114624, 'stability': 3.234647035598755, 'peak_frequencies': []}
  - Quality Assessment: {'authenticity': 0.0, 'consistency': 0.004738867282867432, 'distinction': 0.9893258810043335}
  - Description: Strong nasal resonance. Unstable nasal resonance. Clear distinction between nasal and oral vowels

Liaison:
  - Detected: False
  - Confidence: 0.653
  - Description: Weak or inconsistent liaison patterns

Prosody:
  - Score: 0.045
  - Rhythm Quality: 0.090
  - Intonation Quality: 0.000

Vowel Quality:
  - Quality Score: 0.007
  - Formant Structure: 0.000
  - Description: Poor vowel articulation. Unclear formant structure
2025-02-28 11:07:33,739 - services.translation_routes - INFO - [translation_routes.py:130] - ==================================================

2025-02-28 11:07:33,739 - services.audio_processor - INFO - [audio_processor.py:280] - Loading audio from: /var/folders/x2/xbbstcms7ng3g13w2py4kwsc0000gn/T/tmpe50ijtch.wav
2025-02-28 11:07:33,739 - services.audio_processor - INFO - [audio_processor.py:282] - Audio info - Sample rate: 16000, Channels: 1
2025-02-28 11:07:33,740 - services.audio_processor - INFO - [audio_processor.py:291] - Original audio shape: torch.Size([1, 105163]), Frequency: 16000Hz
2025-02-28 11:07:33,745 - services.audio_processor - INFO - [audio_processor.py:449] - Base audio processing successful, proceeding with enhancement
2025-02-28 11:07:33,748 - services.audio_processor - INFO - [audio_processor.py:457] - Background music analysis: {'has_background_music': False, 'music_confidence': 0.15608341036219223, 'feature_scores': {'spectral_flatness': 0.03820588165673722, 'rhythm_regularity': 0.023762376237623763, 'bass_presence': 0.039862824445829455, 'temporal_stability': 0.054252328022001785}, 'speech_vs_music': {'speech_prominence': 7.497730333222908, 'speech_band_energy': 2.2766175789001863e-07, 'music_band_energy': 3.0264089900811086e-08}}
2025-02-28 11:07:33,748 - services.audio_processor - INFO - [audio_processor.py:460] - Applying speech-optimized spectral enhancement for fra
2025-02-28 11:07:33,757 - services.audio_processor - INFO - [audio_processor.py:470] - Analyzing audio quality...
2025-02-28 11:07:33,767 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:363] - Visualization failed: module 'collections' has no attribute 'Iterable'
2025-02-28 11:07:33,767 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:764] - Harmonic analysis failed: mean(): could not infer output dtype. Input dtype must be either a floating point or complex dtype. Got: Long
2025-02-28 11:07:33,771 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:363] - Visualization failed: module 'collections' has no attribute 'Iterable'
2025-02-28 11:07:33,771 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:764] - Harmonic analysis failed: mean(): could not infer output dtype. Input dtype must be either a floating point or complex dtype. Got: Long
2025-02-28 11:07:33,775 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:363] - Visualization failed: module 'collections' has no attribute 'Iterable'
2025-02-28 11:07:33,776 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:764] - Harmonic analysis failed: mean(): could not infer output dtype. Input dtype must be either a floating point or complex dtype. Got: Long
2025-02-28 11:07:33,780 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:363] - Visualization failed: module 'collections' has no attribute 'Iterable'
2025-02-28 11:07:33,780 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:764] - Harmonic analysis failed: mean(): could not infer output dtype. Input dtype must be either a floating point or complex dtype. Got: Long
2025-02-28 11:07:33,927 - services.diagnostics.base - INFO - [base.py:112] - Completed language analysis for fra
2025-02-28 11:07:33,927 - services.translation_routes - INFO - [translation_routes.py:153] - Request 45bcfbe6: Background music analysis: {'has_background_music': False, 'music_confidence': 0.15608341036219223, 'feature_scores': {'spectral_flatness': 0.03820588165673722, 'rhythm_regularity': 0.023762376237623763, 'bass_presence': 0.039862824445829455, 'temporal_stability': 0.054252328022001785}, 'speech_vs_music': {'speech_prominence': 7.497730333222908, 'speech_band_energy': 2.2766175789001863e-07, 'music_band_energy': 3.0264089900811086e-08}}
2025-02-28 11:07:33,927 - services.translation_strategy - INFO - [translation_strategy.py:23] - Content Type: speech_with_music (Music confidence: 0.15608341036219223)
2025-02-28 11:07:33,927 - services.translation_routes - INFO - [translation_routes.py:165] - Request 45bcfbe6: Audio characteristics heard: {'content_type': 'speech_with_music', 'heard_characteristics': {'music': {'detected': False, 'confidence': 0.15608341036219223}}}
2025-02-28 11:07:33,928 - services.translation_routes - INFO - [translation_routes.py:167] - Request 45bcfbe6: Audio processed successfully
2025-02-28 11:07:33,934 - services.translation_routes - INFO - [translation_routes.py:184] - Input keys: dict_keys(['input_features', 'attention_mask'])
2025-02-28 11:07:39,493 - services.translation_routes - INFO - [translation_routes.py:223] - Source text: if you wouldn't fight what do you think it would be I would definitely be a diabetic
2025-02-28 11:07:46,369 - services.translation_routes - INFO - [translation_routes.py:243] - Target text: Si tu ne faisais pas ça, ce que tu penses que tu pourrais faire, je serais définitivement diabétique.
2025-02-28 11:07:53,996 - services.translation_routes - INFO - [translation_routes.py:267] - Processing tuple output from model
2025-02-28 11:07:54,006 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:363] - Visualization failed: module 'collections' has no attribute 'Iterable'
2025-02-28 11:07:54,006 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:764] - Harmonic analysis failed: mean(): could not infer output dtype. Input dtype must be either a floating point or complex dtype. Got: Long
2025-02-28 11:07:54,011 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:363] - Visualization failed: module 'collections' has no attribute 'Iterable'
2025-02-28 11:07:54,011 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:764] - Harmonic analysis failed: mean(): could not infer output dtype. Input dtype must be either a floating point or complex dtype. Got: Long
2025-02-28 11:07:54,015 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:363] - Visualization failed: module 'collections' has no attribute 'Iterable'
2025-02-28 11:07:54,016 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:764] - Harmonic analysis failed: mean(): could not infer output dtype. Input dtype must be either a floating point or complex dtype. Got: Long
2025-02-28 11:07:54,019 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:363] - Visualization failed: module 'collections' has no attribute 'Iterable'
2025-02-28 11:07:54,019 - services.diagnostics.spectral_analysis - ERROR - [spectral_analysis.py:764] - Harmonic analysis failed: mean(): could not infer output dtype. Input dtype must be either a floating point or complex dtype. Got: Long
2025-02-28 11:07:54,144 - services.diagnostics.base - INFO - [base.py:112] - Completed language analysis for fra
2025-02-28 11:07:54,145 - services.translation_routes - INFO - [translation_routes.py:294] - 
==================================================
2025-02-28 11:07:54,145 - services.translation_routes - INFO - [translation_routes.py:295] - Translated Audio Quality Report
2025-02-28 11:07:54,145 - services.translation_routes - INFO - [translation_routes.py:296] - ==================================================
2025-02-28 11:07:54,145 - services.translation_routes - INFO - [translation_routes.py:297] - Request ID: 45bcfbe6
2025-02-28 11:07:54,145 - services.translation_routes - INFO - [translation_routes.py:298] - Target Language: fra
2025-02-28 11:07:54,145 - services.translation_routes - INFO - [translation_routes.py:299] - --------------------------------------------------
2025-02-28 11:07:54,145 - services.translation_routes - INFO - [translation_routes.py:300] - Audio Quality Analysis Report
==============================

Target Language: fra

Waveform Analysis:
--------------------
- Peak Amplitude: 0.492
- Avg Amplitude: 0.051
- Rms Level: 0.083
- Crest Factor: 5.901
- Zero Crossings: 13509.000
- Silence Percentage: 12.754
- Clipping Points: 0.000
- Dynamic Range: 206.157

- Processing Metrics:
  - Compression Detected: 0.000
  - Over Compressed: 0.000
  - Compression Severity: 0.262
  - Dynamic Range Loss: 0.000

- Temporal Metrics:
  - Smoothing Detected: 1.000
  - Temporal Variation: 0.023
  - Temporal Flatness: 0.013

- Volume Metrics:
  - Volume Stability: 0.224
  - Volume Range: 181.221
  - Volume Variations: 0.051

Spectral Analysis:
--------------------

Quality Metrics (1-5 scale):
--------------------
- Robotic Voice: 1.0
- Pronunciation: 1.0
- Audio Clarity: 3.0282525947262173
- Background Noise: 3.3605953147310896
- Voice Consistency: 1.0
- Spectral Balance: 1.0

Detected Issues:
--------------------
- Muffled

Language-Specific Analysis:
--------------------

Nasalization:
  - Nasal Resonance: {'strength': 0.7069417238235474, 'stability': 3.2708752155303955, 'peak_frequencies': []}
  - Quality Assessment: {'authenticity': 0.12426472455263138, 'consistency': 0.0, 'distinction': 1.0}
  - Description: Strong nasal resonance. Unstable nasal resonance. Clear distinction between nasal and oral vowels

Liaison:
  - Detected: False
  - Confidence: 0.538
  - Description: Weak or inconsistent liaison patterns

Prosody:
  - Score: 0.000
  - Rhythm Quality: 0.000
  - Intonation Quality: 0.000

Vowel Quality:
  - Quality Score: 0.003
  - Formant Structure: 0.000
  - Description: Poor vowel articulation. Unclear formant structure
2025-02-28 11:07:54,145 - services.translation_routes - INFO - [translation_routes.py:301] - ==================================================

2025-02-28 11:07:54,145 - services.translation_routes - INFO - [translation_routes.py:307] - Request 45bcfbe6: Audio output processed successfully
2025-02-28 11:07:54,148 - services.translation_routes - INFO - [translation_routes.py:362] - Request 45bcfbe6: Response prepared successfully
2025-02-28 11:07:54,148 - services.translation_routes - INFO - [translation_routes.py:375] - Request 45bcfbe6 completed in 20.62s
2025-02-28 11:07:54,148 - services.utils - INFO - [utils.py:57] - Performance - Function: translate_audio_endpoint, Duration: 20.62s, Memory Change: 372.17MB
2025-02-28 11:07:54,148 - __main__ - INFO - [app.py:279] - Request to /translate took 57.74s
